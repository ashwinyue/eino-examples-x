# 基于 eino adk 和 Milvus 的狼人杀游戏系统实现计划

## 1. 项目初始化
- **创建 Go 项目**：在 `week11-homework` 目录下初始化 Go 模块
- **安装依赖**：
  - eino adk 库
  - Milvus Go SDK
  - 其他必要的依赖库

## 2. 核心组件设计

### 2.1 游戏逻辑 (game.go)
- **游戏状态管理**：定义游戏状态结构体，包括玩家列表、角色分配、游戏阶段、死亡玩家等
- **游戏流程控制**：实现夜晚行动、天亮公布、发言环节、投票处决等阶段
- **胜负判断**：判断村民或狼人是否获胜

### 2.2 Agent 定义 (agents.go)
- **主持人 Agent**：控制游戏流程，协调各个阶段
- **玩家 Agent**：
  - 村民 Agent：具备推理能力，基于历史记忆判断他人身份
  - 狼人 Agent：具备伪装能力，隐藏身份，夜晚选择杀人
- **Agent 配置**：每个 Agent 有自己的角色记忆、发言策略和决策逻辑

### 2.3 记忆管理 (memory.go)
- **Milvus 连接管理**：初始化 Milvus 客户端，管理连接
- **集合设计**：创建 Milvus 集合用于存储游戏记忆
- **数据结构**：定义游戏记忆的数据结构，包括发言内容、发言者、时间、游戏阶段等
- **向量生成**：将游戏记忆转换为向量表示
- **记忆存储**：将向量数据插入到 Milvus 集合中
- **记忆检索**：根据当前上下文检索相关的历史记忆

### 2.4 RAG 增强 (rag.go)
- **检索增强**：在 Agent 决策前，检索相关的历史记忆
- **上下文融合**：将检索到的记忆融合到 Agent 的决策上下文中
- **生成优化**：基于融合后的上下文生成更智能的决策和发言

### 2.5 主入口 (main.go)
- **初始化**：初始化 Milvus 客户端、创建 Agent 实例
- **游戏启动**：启动游戏流程
- **日志输出**：输出完整的游戏日志

## 3. Prompt 模板设计
- **主持人 Prompt**：定义主持人的角色和职责
- **村民 Prompt**：定义村民的角色、目标和发言策略
- **狼人 Prompt**：定义狼人的角色、目标和伪装策略

## 4. 游戏流程实现

### 4.1 初始化阶段
- 分配角色：3村民 + 2狼人
- 初始化游戏状态
- 创建 Milvus 集合

### 4.2 夜晚阶段
- 狼人 Agent 协商杀人目标
- 记录夜晚行动到 Milvus

### 4.3 天亮阶段
- 主持人公布死亡信息
- 记录死亡信息到 Milvus

### 4.4 发言阶段
- 每个玩家依次发言
- 发言前检索相关历史记忆
- 基于当前局势和历史记忆生成发言
- 记录发言内容到 Milvus

### 4.5 投票阶段
- 每个玩家投票处决嫌疑人
- 基于当前局势和历史记忆生成投票决策
- 记录投票结果到 Milvus

### 4.6 胜负判断
- 检查是否有一方获胜
- 如果没有获胜，进入下一轮
- 如果获胜，公布游戏结果

## 5. 技术实现细节

### 5.1 Milvus 集成
- **连接配置**：使用默认端口 19530 连接 Milvus 服务器
- **集合设计**：
  - 字段：id (主键), content (发言内容), speaker (发言者), phase (游戏阶段), timestamp (时间戳), vector (向量)
  - 向量维度：根据使用的嵌入模型确定
- **索引配置**：使用 IVF_FLAT 索引，便于快速检索

### 5.2 RAG 实现
- **嵌入模型**：使用适合中文的嵌入模型，将文本转换为向量
- **检索策略**：基于相似度检索，获取最相关的历史记忆
- **上下文融合**：将检索到的记忆与当前上下文结合，生成完整的决策上下文

### 5.3 Agent 决策流程
- **输入**：当前游戏状态 + 检索到的历史记忆
- **处理**：通过大语言模型生成决策
- **输出**：发言内容或投票结果

## 6. 运行方式
1. **确保 Milvus 服务运行**：
   ```bash
   docker-compose -f milvus-standalone-docker-compose.yml ps
   ```
2. **运行游戏**：
   ```bash
   cd week11-homework
   go run main.go
   ```
3. **查看日志**：游戏会输出完整的日志，包括每个 Agent 的思考过程和行动

## 7. 预期效果
- 支持 5 名 AI 玩家（3村民 + 2狼人）参与游戏
- 实现完整的游戏流程
- 每个 Agent 具备角色身份记忆、发言策略生成能力、身份伪装或揭露行为
- 使用 Milvus 向量数据库实现跨轮次的记忆存储和检索
- 实现 RAG 增强，让 Agent 能够基于历史记忆生成更智能的决策
- 输出完整的游戏日志，包括每个 Agent 的思考过程和行动

## 8. 代码结构
```
week11-homework/
├── main.go              # 主入口文件
├── game.go              # 游戏逻辑实现
├── agents.go            # Agent 定义
├── memory.go            # 基于 Milvus 的记忆管理
├── rag.go               # RAG 增强实现
├── prompts/             # Prompt 模板目录
│   ├── moderator.md     # 主持人 Prompt
│   ├── villager.md      # 村民 Prompt
│   └── werewolf.md      # 狼人 Prompt
└── go.mod               # Go 模块定义
```

## 9. 开发步骤
1. 初始化 Go 项目，安装依赖
2. 实现 Milvus 连接和记忆管理模块
3. 实现游戏逻辑和状态管理
4. 实现 Agent 定义和决策逻辑
5. 实现 RAG 增强功能
6. 编写 Prompt 模板
7. 实现主入口和游戏流程
8. 测试和调试
9. 优化和改进

## 10. 关键技术点
- **多 Agent 协作**：使用 eino adk 实现 Agent 之间的协作和通信
- **向量数据库应用**：使用 Milvus 实现高效的记忆存储和检索
- **RAG 增强**：结合大语言模型和向量数据库，提升 Agent 的决策能力
- **游戏状态管理**：实现复杂游戏状态的管理和转换
- **发言策略生成**：让 Agent 能够生成自然、合理的发言

## 11. 注意事项
- **Milvus 服务依赖**：确保 Milvus 服务正常运行，否则游戏无法存储和检索记忆
- **大语言模型配置**：确保正确配置大语言模型的 API 密钥和参数
- **性能优化**：考虑 Milvus 向量检索的性能，优化检索策略
- **日志记录**：详细记录游戏过程，便于调试和分析

## 12. 扩展方向
- 支持更多角色：预言家、女巫、猎人等
- 支持更多玩家数量
- 实现可视化界面，展示游戏流程和 Agent 决策过程
- 优化 Agent 决策逻辑，提升游戏的趣味性和挑战性

这个计划详细描述了基于 eino adk 和 Milvus 的狼人杀游戏系统的实现方案，包括项目结构、核心组件设计、技术实现细节和开发步骤。通过这个计划，可以系统地实现一个具备角色身份记忆、发言策略生成能力、身份伪装或揭露行为的智能狼人杀游戏系统。